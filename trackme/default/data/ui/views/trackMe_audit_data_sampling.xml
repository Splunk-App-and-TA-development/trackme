<dashboard>
  <label>TrackMe - Data sampling and events formats recognition audit</label>
  <row>
    <panel>
      <title>Number of monitored and active data sources during the last 24 hours</title>
      <single>
        <search>
          <query>| inputlookup trackme_data_source_monitoring where data_monitored_state="enabled" | eval keyid = _key | where data_last_time_seen&gt;relative_time(now(), "-24h")
| stats dc(keyid) as dcount</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">DATA SOURCES</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Number of Data sampling entities in the processed collection</title>
      <single>
        <search>
          <query>| inputlookup trackme_data_sampling | eval keyid = _key
| stats dc(keyid) as dcount</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">DATA SOURCES</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Data sources and data sampling status table</title>
        <search>
          <query>| inputlookup trackme_data_source_monitoring | eval keyid=_key
| fields keyid, data_name, data_sample_lastrun, isAnomaly
| eval data_sample_lastrun=if(data_sample_lastrun!=0, strftime(data_sample_lastrun, "%c"), "N/A (no successful run yet)")</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="data_sample_lastrun">
          <colorPalette type="map">{"N/A (no successful run yet)":#FF6961}</colorPalette>
        </format>
        <format type="color" field="isAnomaly">
          <colorPalette type="map">{"1":#FF6961}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Data sampling records details</title>
        <search>
          <query>| inputlookup trackme_data_sampling | eval keyid=_key
| fields keyid, data_name, *
| fields - raw_*
| fields keyid, data_name, data_sample_anomaly_detected, data_sample_anomaly_reason, data_sample_feature, *</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="data_sample_anomaly_detected">
          <colorPalette type="map">{"1":#FF6961}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Tracker scheduler execution metrics</title>
        <search>
          <query>index=_internal sourcetype=scheduler earliest=-4h latest=now status="*" AND status!="continued" trackme app="trackme" savedsearch_name="TrackMe - Data sampling and format detection tracker"
| stats avg(run_time) AS avg_run_time, max(run_time) AS max_run_time, latest(run_time) AS latest_run_time, latest(result_count) as last_processed_no_entities by savedsearch_name
| foreach avg_run_time max_run_time latest_run_time [ eval &lt;&lt;FIELD&gt;&gt; = round('&lt;&lt;FIELD&gt;&gt;', 2) ]
| appendcols [ | inputlookup trackme_data_source_monitoring where data_monitored_state="enabled" | stats count as total_entities ]
| eval potential_rate_sec=round(latest_run_time/last_processed_no_entities, 2)
| eval max_accepted_run_time_sec=`trackme_data_sampling_max_allowed_runtime_sec`
| eval max_entities_to_process=round(max_accepted_run_time_sec/potential_rate_sec, 0)</query>
          <earliest>-4h@m</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="last_processed_no_entities">
          <colorPalette type="map">{"0":#FF6961}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Scheduler executions over time</title>
        <search>
          <query>index=_internal sourcetype=scheduler earliest=-4h latest=now status="*" AND status!="continued" trackme app="trackme" savedsearch_name="TrackMe - Data sampling and format detection tracker"
| stats latest(run_time) AS run_time, latest(result_count) as last_processed_no_entities by _time, savedsearch_name
| eval run_time = round(run_time, 2)
| appendcols [ | inputlookup trackme_data_source_monitoring where data_monitored_state="enabled" | stats count as total_entities ]
| filldown total_entities
| eval potential_rate_sec=round(latest_run_time/last_processed_no_entities, 2)
| eval max_accepted_run_time_sec=`trackme_data_sampling_max_allowed_runtime_sec`
| eval max_entities_to_process=round(max_accepted_run_time_sec/potential_rate_sec, 0)
| sort - limit=0 _time</query>
          <earliest>-4h@m</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</dashboard>